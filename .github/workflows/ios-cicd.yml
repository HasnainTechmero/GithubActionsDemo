name: iOS CI/CD

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: macos-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@main

    - name: Set up Xcode 15.0.1
      run: |
        sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
        xcodebuild -version
      shell: bash

    - name: Set up Git
      run: |
        git config --global user.email "hasnaintechmero@gmail.com"
        git config --global user.name "HasnainTechmero"
        git checkout main
      env:
        GIT_AUTH_TOKEN: ${{ secrets.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 }}

    - name: Update Version and Build Number
      run: |
        PLIST_FILE=/Users/techbaroda/Projects/GithubActionsDemo_App/GithubActionsDemo/GithubActionsDemo/Info.plist
        BUILD_NUMBER=$(/usr/libexec/PlistBuddy -c "Print CFBuildVersion" "$PLIST_FILE")
        NEW_BUILD_NUMBER=$((BUILD_NUMBER + 1))
        echo "New build number: $NEW_BUILD_NUMBER"
        /usr/libexec/PlistBuddy -c "Set :CFBuildVersion $NEW_BUILD_NUMBER" "$PLIST_FILE"
        
        git config --global user.email "hasnaintechmero@gmail.com"
        git config --global user.name "HasnainTechmero"
       
        git add "$PLIST_FILE"
        git commit -m "Bump build number to $NEW_BUILD_NUMBER"
        git push origin main
      env:
        GITHUB_TOKEN: ${{ secrets.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 }}






        
    #- name: Build and Run
    #  run: |
     #   xcodebuild -project /Users/techbaroda/Projects/GithubActionsDemo_App/GithubActionsDemo/GithubActionsDemo.xcodeproj -scheme GithubActionsDemoYourScheme -destination "platform=iOS Simulator,OS=16.0,name=iPhone 13" clean build test
     # working-directory: /Users/techbaroda/Projects/GithubActionsDemo_App/GithubActionsDemo/
      
    
   # - name: Deploy
      #uses: actions/setup-xcode@main
      # Add your deployment steps here, e.g., uploading to App Store Connect or TestFlight
